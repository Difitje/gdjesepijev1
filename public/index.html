<!DOCTYPE html>
<html lang="hr">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Gdje se pije? (beta) </title>
    <link rel="stylesheet" href="/style.css">
    <style>
        /* Novi CSS za centriranje teksta "Trenutno nitko ne pije" */
        /* Ova pravila su prebaƒçena u .search-results klasu u style.css */
        /*
        #pijankePregled.empty-message {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100%;
            text-align: center;
            flex-direction: column;
        }
        #pijankePregled.empty-message p {
            margin: 0;
        }
        */

        /*
           Dodatni stil za div "noPijankeMessage" kako bi se rastegnuo
           i centrirao sadr≈æaj unutar #homePrikazPijanki
        */
        #noPijankeMessage {
            flex-grow: 1; /* Omoguƒáuje divu da zauzme sav dostupan vertikalni prostor */
            display: flex; /* Ponovno ga uƒçinimo flex kontejnerom za njegov sadr≈æaj (tekst) */
            justify-content: center; /* Centriranje teksta horizontalno unutar #noPijankeMessage */
            align-items: center; /* Centriranje teksta vertikalno unutar #noPijankeMessage */
            text-align: center; /* Dodatno osiguranje za centriranje teksta unutar #noPijankeMessage */
            color: #888; /* Boja teksta iz .search-results */
            font-size: 15px; /* Veliƒçina fonta iz .search-results */
            padding: 20px; /* Dodajte malo paddinga ako ≈æelite */
            box-sizing: border-box; /* Va≈æno za ispravan padding i ≈°irinu */
        }

        /* Postavite .search-results na 100% ≈°irine unutar svog roditelja */
        .search-results {
            width: 100%; /* Ovo ƒáe osigurati da .search-results zauzima punu ≈°irinu unutar #homePrikazPijanki */
            /* Ostali .search-results stilovi su u style.css */
        }

        /* Privremeni stil za sakrivanje glavnog loga ako vam smeta na praznom ekranu */
        #homePrikazPijanki .main-header {
             display: flex; /* Vratite na flex */
             justify-content: center;
             align-items: center;
             position: absolute; /* Ili relative, ovisno o ≈æeljenom layoutu */
             top: 0;
             width: 100%;
             height: 60px; /* Visina headera */
             z-index: 100;
             background-color: rgba(0, 0, 0, 0.95); /* Dodajte pozadinu ako header stoji */
        }
        #homePrikazPijanki .main-header h1.main-logo {
            display: block; /* Ili flex, ako je logo slika/svg */
        }


    </style>
</head>
<body>
    <div class="container" id="intro">
        <h2>üçª Dosadno vam je?</h2>
        <p style="text-align:center;">Pridru≈æi se ekipi koja zna kako se loƒçe!</p>
        <button onclick="navigateTo('odabir')">Pridru≈æi se</button>
    </div>

    <div class="container" id="pravilaEkran">
        <div class="top-nav-buttons">
            <button class="back-button" onclick="navigateBack()">‚Üê</button>
        </div>
        <h2>Pravila kori≈°tenja</h2>
        <div class="pravila-text">
            <p>Dobrodo≈°li! Prije nego ≈°to nastavite, molimo vas da pa≈æljivo proƒçitate i prihvatite sljedeƒáa pravila:</p>
            <p><strong>1. Punoljetnost:</strong> Morate imati najmanje 18 godina da biste koristili ovu aplikaciju.</p>
            <p><strong>2. Po≈°tovanje:</strong> Pona≈°ajte se prema drugima s po≈°tovanjem. Bilo kakav oblik uznemiravanja, govora mr≈ænje ili nasilnog pona≈°anje nije dozvoljen i rezultirat ƒáe trajnom zabranom.</p>
            <p><strong>3. Sigurnost na prvom mjestu:</strong> Kada se sastajete s drugim korisnicima, ƒçinite to na javnim i sigurnim mjestima. Obavijestite prijatelja gdje idete. Budite odgovorni.</p>
            <p><strong>4. Zakonitost:</strong> Zabranjeno je organiziranje ili promoviranje bilo kakvih ilegalnih aktivnosti putem ove platforme.</p>
            <p><strong>Odricanje od odgovornosti:</strong> Ova aplikacija je samo platforma za povezivanje. Mi, kao kreatori, nismo odgovorni za pona≈°anje korisnika, niti za bilo kakve direktne ili indirektne posljedice, ≈°tete ili povrede koje mogu nastati kao rezultat kori≈°tenja aplikacije. Koristite je na vlastitu odgovornost.</p>
        </div>
        <div class="pravila-checkbox-wrapper">
            <input type="checkbox" id="prihvatamPravila" onchange="proveriPrihvatanje()">
            <label for="prihvatamPravila">Proƒçitao/la sam i prihvaƒáam pravila.</label>
        </div>
        <button id="nastaviBtn" onclick="navigateTo('registracija')" disabled>Prihvati i nastavi</button>
    </div>

    <div class="container" id="odabir">
        <h2>Dobrodo≈°li!</h2>
        <p style="text-align:center;">Ima≈° raƒçun? Prijavi se. Nema≈°? Registriraj se.</p>
        <button onclick="navigateTo('login')">Prijava</button>
        <button onclick="navigateTo('pravilaEkran')">Registracija</button>
    </div>

    <div class="container" id="login">
        <div class="top-nav-buttons">
            <button class="back-button" onclick="navigateBack()">‚Üê</button>
        </div>
        <h2>Prijava</h2>
        <input id="loginIme" placeholder="Korisniƒçko ime" />
        <input id="loginSifra" type="password" placeholder="Lozinka" />
        <button id="loginSubmitBtn" onclick="ulogujSe()">Prijavi se</button>
    </div>

    <div class="container" id="registracija">
        <div class="top-nav-buttons">
            <button class="back-button" onclick="navigateBack()">‚Üê</button>
        </div>
        <h2>Registracija</h2>
        <input id="ime" placeholder="Korisniƒçko ime" />
        <input id="sifra" type="password" placeholder="Lozinka" />
        <label style="font-size:14px; display:block; margin-bottom:5px;">Profilna slika:</label>
        <input type="file" id="slikaUpload" accept="image/*" />
        <img id="previewSlikes" class="preview-slika" /> <input id="instagram" placeholder="Instagram korisniƒçko ime (bez @)" />
        <input id="tiktok" placeholder="TikTok korisniƒçko ime (bez @)" />
        <textarea id="opis" placeholder="O meni..." rows="3"></textarea>
        <button id="registracijaSubmitBtn" onclick="registruj()">Spremi</button>
    </div>

    <div class="container" id="homePrikazPijanki">
        <div class="main-header">
            <h1 class="main-logo">
                </h1>
        </div>
        
        <div id="pijankePregled">
            </div>

        <div id="noPijankeMessage" class="search-results" style="display: none;">
            trenutno nitko ne pije., budi prvi!
        </div>
    </div>

    <div class="container" id="praznaTrazilica">
        <div class="main-header">
            <h1 class="main-logo">
                </h1>
        </div>
        <div class="search-bar-modern">
            <input type="text" id="mainSearchBarInput" placeholder="Pretra≈æi..." oninput="handleSearchInput()">
            <svg class="search-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                <path d="M10.5 3.75a6.75 6.75 0 100 13.5 6.75 6.75 0 000-13.5zM2.25 10.5a8.25 8.25 0 1114.59 5.28l4.697 4.698a.75.75 0 11-1.06 1.06l-4.697-4.697A8.25 8.25 0 012.25 10.5z" />
            </svg>
        </div>
        <div id="searchResults" class="search-results">
            <p style="text-align:center; color:#888; margin-top:20px;">Ovdje ƒáe se prikazivati rezultati pretrage.</p>
        </div>
    </div>

    <div class="container" id="inboxPrikaz">
        <h2>Poruke</h2>
        <div class="inbox-search-bar">
            <input type="text" id="inboxSearchBarInput" placeholder="Pretra≈æi razgovore..." oninput="filterChatItems()">
            <svg class="search-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                <path d="M10.5 3.75a6.75 6.75 0 100 13.5 6.75 6.75 0 000-13.5zM2.25 10.5a8.25 8.25 0 1114.59 5.28l4.697 4.698a.75.75 0 11-1.06 1.06l-4.697-4.697A8.25 8.25 0 012.25 10.5z" />
            </svg>
        </div>
        <div id="listaChatova"></div>
    </div>

    <div class="container" id="glavniDio">
        <div class="top-nav-buttons">
            <button class="back-button" onclick="navigateBack()" style="display:none;">‚Üê</button>
            <button class="close-btn" id="profileCloseBtn" onclick="navigateTo('homePrikazPijanki')" style="display:none;">‚úñ</button>
        </div>
        <h2 id="glavniNaslov"></h2>
        <div id="objavaForma">
            <textarea id="opisPijanke" placeholder="Opis pijanke (npr: nas 5 kod mene üî•)"></textarea>
            <button onclick="objaviPijanku()">Objavi</button>
        </div>
        <div id="profilKorisnika" data-user-id=""></div>
    </div>

    <div class="container" id="privatniChat">
        <div class="top-nav-buttons">
            <button class="back-button" onclick="navigateBack()">‚Üê</button>
        </div>
    <div class="chat-header-info">
        <img id="chatPartnerSlika" src="default_profile.png" alt="Profilna slika" class="chat-partner-profilna">
        <div class="chat-info-text-wrapper">
            <h2 id="chatSaKorisnikom"></h2>
            <p id="chatPartnerStatus" class="status-text"></p>
        </div>
    </div>
        <div id="privatniChatLog" class="chat"></div>
        <div class="chat-input-area">
            <input type="file" id="imageUploadChat" accept="image/*" style="display: none;" />
            <div class="image-upload-icon" onclick="document.getElementById('imageUploadChat').click()">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" stroke="none">
                    <path d="M8.5 13.5l-3.5 4.5h11l-4-6-3.5 4z"/>
                    <circle cx="9" cy="8" r="2.5"/>
                    <path d="M21 21H3a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h18a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2zM3 5v14h18V5H3z"/>
                </svg>
            </div>

            <textarea id="privatniInput" placeholder="Poruka..." rows="1"></textarea>

            <button id="posaljiPrivatnoBtn" onclick="posaljiPrivatno()" disabled>
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M3.478 2.405a.75.75 0 00-.926.94l2.432 7.905H13.5a.75.75 0 010 1.5H4.984l-2.432 7.905a.75.75 0 00.926.94 60.519 60.519 0 0018.445-8.986.75.75 0 000-1.218A60.517 60.517 0 003.478 2.405z" />
                </svg>
            </button>
        </div>
    </div>

    <div class="container" id="editProfil">
        <div class="top-nav-buttons">
            <button class="back-button" onclick="navigateBack()">‚Üê</button>
            <button id="sacuvajProfilBtn" class="confirm-button hidden" onclick="sacuvajProfil()">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                    <path fill-rule="evenodd" d="M2.25 12c0-5.385 4.365-9.75 9.75-9.75s9.75 4.365 9.75 9.75-4.365 9.75-9.75 9.75S2.25 17.385 2.25 12zm13.36-1.814a.75.75 0 10-1.22-.872l-3.236 4.532-1.267-1.267a.75.75 0 00-1.06 1.06l1.75 1.75a.75.75 0 001.135.082l3.75-5.25z" clip-rule="evenodd" />
                </svg>
            </button>
        </div>
        <h2>Uredi profil</h2>
        <div class="profile-picture-edit-wrapper">
            <img id="previewEditSlikes" class="profilna-slika" onclick="document.getElementById('hiddenEditSlikaUpload').click()" />
            <div class="camera-icon-overlay">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                    <path fill-rule="evenodd" d="M1.5 6a2.25 2.25 0 012.25-2.25h16.5A2.25 2.25 0 0122.5 6v12a2.25 2.25 0 01-2.25 2.25H3.75A2.25 2.25 0 011.5 18V6zM3 16.06V18c0 .414.336.75.75.75h16.5a.75.75 0 00.75-.75v-1.94l-2.432-2.432a1.125 1.125 0 00-1.57-.037l-3.535 3.535a1.125 1.125 0 01-1.571 0L5.25 9.53l-3.75 6.53Z" clip-rule="evenodd" />
                    <path fill-rule="evenodd" d="M12.559 10.559a.75.75 0 01.75.75v4.5a.75.75 0 01-1.5 0v-4.5a.75.75 0 01.75-.75Z" clip-rule="evenodd" />
                    <path fill-rule="evenodd" d="M12 1a.75.75 0 01.75.75V6a.75.75 0 01-1.5 0V1.75A.75.75 0 0112 1Z" clip-rule="evenodd" />
                    <path fill-rule="evenodd" d="M6 3.25a.75.75 0 01.75.75v4.5a.75.75 0 01-1.5 0V4a.75.75 0 01.75-.75Z" clip-rule="evenodd" />
                    <path fill-rule="evenodd" d="M18 3.25a.75.75 0 01.75.75v4.5a.75.75 0 01-1.5 0V4a.75.75 0 01.75-.75Z" clip-rule="evenodd" />
                </svg>

            </div>
        </div>
        <input type="file" id="hiddenEditSlikaUpload" accept="image/*" style="display: none;" />

        <label for="editIme">Korisniƒçko ime:</label>
        <input id="editIme" placeholder="Korisniƒçko ime" />
        <label for="editOpis">O meni:</label>
        <textarea id="editOpis" placeholder="O meni..." rows="3"></textarea>
        <label for="editInstagram">Instagram korisniƒçko ime:</label>
        <input id="editInstagram" placeholder="Instagram korisniƒçko ime" />
        <label for="editTiktok">TikTok korisniƒçko ime:</label>
        <input id="editTiktok" placeholder="TikTok korisniƒçko ime" />
    </div>

    <button id="fabObjaviPijanku" class="fab hidden-initially" onclick="pokaziObjavu()">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="3" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" />
        </svg>
    </button>

    <nav class="bottom-nav hidden-initially">
        <button class="nav-button active" id="navHome" onclick="handleNavClick('homePrikazPijanki');">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 12l8.954-8.955c.44-.439 1.152-.439 1.591 0L21.75 12M4.5 9.75v10.125c0 .621.504 1.125 1.125 1.125H9.75v-4.875c0-.621.504 1.125 1.125 1.125h2.25c.621 0 1.125.504 1.125 1.125v4.875h4.125c.621 0 1.125-.504 1.125-1.125V9.75M8.25 21.75h7.5" />
            </svg>
            <span>Home</span>
        </button>
        <button class="nav-button" id="navSearch" onclick="handleNavClick('praznaTrazilica');">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                <path fill-rule="evenodd" d="M10.5 3.75a6.75 6.75 0 100 13.5 6.75 6.75 0 000-13.5zM2.25 10.5a8.25 8.25 0 1114.59 5.28l4.697 4.698a.75.75 0 11-1.06 1.06l-4.697-4.697A8.25 8.25 0 012.25 10.5z" clip-rule="evenodd" />
            </svg>
            <span>Tra≈æilica</span>
        </button>
        <button class="nav-button" id="navInbox" onclick="handleNavClick('inboxPrikaz');">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" d="M6 12L3.269 3.126A59.768 59.768 0 0121.485 12 59.77 59.77 0 013.27 20.876L5.999 12zm0 0h7.5" />
            </svg>
            <span>Inbox</span>
            <span id="notifikacijaPorukaGlavna" class="notification-badge-main"></span>
        </button>
        <button class="nav-button" id="navProfile" onclick="handleNavClick('glavniDio');">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" d="M17.982 18.725A7.488 7.488 0 0012 15.75a7.488 7.488 0 00-5.982 2.975m11.963 0a9 9 0 10-11.963 0m11.963 0A8.966 8.966 0 0112 21a8.966 8.966 0 01-5.982-2.275M15 9.75a3 3 0 11-6 0 3 3 0 016 0z" />
            </svg>
            <span>Profil</span>
        </button>
    </nav>

    <div id="imageModal" class="image-modal">
        <span class="close-image-modal">&times;</span>
        <img class="image-modal-content" id="fullImage">
    </div>

    <div id="userListModal" class="image-modal">
        <span class="close-image-modal" onclick="closeUserListModal()">&times;</span>
        <div class="user-list-modal-content-wrapper">
            <h2 id="userListModalTitle"></h2>
            <div id="userListHtml" class="user-list-scroll-area">
                </div>
        </div>
    </div>
    <script src="/script.js"></script>
    <script>
        // Pomoƒána funkcija za a≈æuriranje aktivnog gumba u navigaciji
        function updateActiveNavButton(activeButtonId) {
            document.querySelectorAll('.bottom-nav .nav-button').forEach(button => {
                button.classList.remove('active');
            });
            const activeButton = document.getElementById(activeButtonId);
            if (activeButton) {
                activeButton.classList.add('active');
            }
        }

        // Pomoƒána funkcija za kontrolu vidljivosti navigacije i FAB gumba
        function toggleAppUI(show) {
            const bottomNav = document.querySelector('.bottom-nav');
            const fabButton = document.getElementById('fabObjaviPijanku');

            if (bottomNav) {
                bottomNav.classList.toggle('hidden-initially', !show);
                bottomNav.style.pointerEvents = show ? 'auto' : 'none';
            }
            if (fabButton) {
                if(show) {
                    fabButton.classList.remove('hidden-initially');
                } else {
                    fabButton.classList.add('hidden-initially');
                }
                fabButton.style.pointerEvents = show ? 'auto' : 'none';
            }
        }

        // Glavna funkcija za rukovanje klikovima na navigacijske gumbe
        function handleNavClick(targetScreenId) {
            const currentActiveNavButton = document.querySelector('.bottom-nav .nav-button.active');
            let currentTargetScreenId = '';

            if (currentActiveNavButton) {
                if (currentActiveNavButton.id === 'navHome') currentTargetScreenId = 'homePrikazPijanki';
                else if (currentActiveNavButton.id === 'navSearch') currentTargetScreenId = 'praznaTrazilica';
                else if (currentActiveNavButton.id === 'navInbox') currentTargetScreenId = 'inboxPrikaz';
                else if (currentActiveNavButton.id === 'navProfile') {
                    if (document.getElementById("profilKorisnika") && document.getElementById("profilKorisnika").style.display !== "none" && document.querySelector('.container.active-screen')?.id === 'glavniDio') {
                        currentTargetScreenId = 'glavniDio';
                    } else if (document.querySelector('.container.active-screen')?.id === 'editProfil') {
                        currentTargetScreenId = 'editProfil';
                    }
                }
            }

            if (targetScreenId === currentTargetScreenId) {
                if (targetScreenId === 'glavniDio' && currentTargetScreenId === 'editProfil') {
                } else {
                    return;
                }
            }


            if (targetScreenId === 'homePrikazPijanki') {
                navigateTo(targetScreenId);
                prikaziPijankePregled(); // Ova funkcija ƒáe sada upravljati prikazom poruke
            } else if (targetScreenId === 'praznaTrazilica') {
                navigateTo(targetScreenId);
            } else if (targetScreenId === 'inboxPrikaz') {
                otvoriInbox();
            } else if (targetScreenId === 'glavniDio') {
                prikaziMojProfil();
            }
        }

        window.addEventListener('DOMContentLoaded', async function() {
            const token = localStorage.getItem("token");

            // Sakrij sve kontejnere na poƒçetku
            document.querySelectorAll('.container').forEach(el => {
                el.style.display = 'none';
                el.classList.remove('active-screen', 'fade-out-screen');
            });

            let appInitializedSuccessfully = false;
            if (token) {
                try {
                    const response = await authenticatedFetch('/api/auth/me');
                    if (response.ok) {
                        const data = await response.json();
                        trenutniKorisnik = data.user;
                        appInitializedSuccessfully = true;
                    } else {
                        console.warn("Token not valid, removing it and logging out.");
                        localStorage.removeItem("token");
                    }
                } catch (error) {
                    console.error("Error fetching user data with token:", error);
                    localStorage.removeItem("token");
                }
            }

            if (appInitializedSuccessfully) {
                pokreniAplikaciju();
            } else {
                // Ako korisnik nije prijavljen, prika≈æi odmah intro ekran
                const introScreen = document.getElementById('intro');
                if (introScreen) {
                    introScreen.style.display = 'flex';
                    introScreen.classList.add('active-screen');
                }
                toggleAppUI(false); // Sakrij navigaciju i FAB dok se ne prijave
            }

            const privatniInput = document.getElementById('privatniInput');
            const posaljiBtn = document.getElementById('posaljiPrivatnoBtn');

            if (privatniInput && posaljiBtn) {
                privatniInput.addEventListener('input', () => {
                    privatniInput.style.height = 'auto';
                    privatniInput.style.height = `${privatniInput.scrollHeight}px`;
                    if (privatniInput.value.trim().length > 0) {
                        posaljiBtn.disabled = false;
                        posaljiBtn.classList.add('enabled');
                    } else {
                        posaljiBtn.disabled = true;
                        posaljiBtn.classList.remove('enabled');
                    }
                });
            }

            const imageUploadChatEl = document.getElementById("imageUploadChat");
            if (imageUploadChatEl) {
                imageUploadChatEl.addEventListener("change", async function() {
                    const file = this.files[0];
                    if (file) {
                        const reader = new FileReader();
                        reader.onload = async e => {
                            const base64Image = e.target.result;
                            const compressedImage = await compressImage(base64Image);
                            await posaljiSlikuPrivatno(compressedImage);
                            imageUploadChatEl.value = '';
                        };
                        reader.readAsDataURL(file);
                    }
                });
            }

            const imageModal = document.getElementById('imageModal');
            const closeImageModal = document.querySelector('.close-image-modal');
            if (closeImageModal) {
                closeImageModal.onclick = function() {
                    imageModal.style.display = 'none';
                    document.body.style.overflow = 'auto';
                };
            }
            if (imageModal) {
                imageModal.addEventListener('click', function(event) {
                    if (event.target === imageModal) {
                        imageModal.style.display = 'none';
                        document.body.style.overflow = 'auto';
                    }
                });
            }
        });

        const originalPokreniAplikaciju = pokreniAplikaciju;
        pokreniAplikaciju = function() {
            originalPokreniAplikaciju();
            toggleAppUI(true); // Prikazi UI pri pokretanju aplikacije
            navigateTo('homePrikazPijanki');
            globalRefreshUI();
        };

        const originalOdjaviSe = odjaviSe;
        odjaviSe = function() {
            originalOdjaviSe();
            toggleAppUI(false);
        };

        function afterSwapUpdateNavButton(targetScreenId) {
            const fabButton = document.getElementById('fabObjaviPijanku');
            const navBarTargetScreens = ['homePrikazPijanki', 'praznaTrazilica', 'inboxPrikaz', 'glavniDio', 'editProfil'];

            // === IZMJENA: Uvijek prikazi/sakrij UI na temelju targetScreenId ===
            if (navBarTargetScreens.includes(targetScreenId)) {
                toggleAppUI(true); // Prikazi nav bar i FAB
            } else {
                toggleAppUI(false); // Sakrij nav bar i FAB
            }
            // =================================================================

            if (fabButton) {
                fabButton.style.display = (targetScreenId === 'homePrikazPijanki') ? 'flex' : 'none';
            }

            // A≈æuriraj aktivni nav gumb
            if (targetScreenId === 'homePrikazPijanki') {
                updateActiveNavButton('navHome');
            } else if (targetScreenId === 'praznaTrazilica') {
                updateActiveNavButton('navSearch');
            } else if (targetScreenId === 'inboxPrikaz') {
                updateActiveNavButton('navInbox');
            } else if (targetScreenId === 'glavniDio') {
                if (document.getElementById("profilKorisnika") && document.getElementById("profilKorisnika").style.display !== "none") {
                    updateActiveNavButton('navProfile');
                } else {
                    document.querySelectorAll('.bottom-nav .nav-button').forEach(button => {
                        button.classList.remove('active');
                    });
                }
            } else if (targetScreenId === 'editProfil') {
                updateActiveNavButton('navProfile');
            }
            else if (targetScreenId === 'privatniChat') {
                document.querySelectorAll('.bottom-nav .nav-button').forEach(button => {
                    button.classList.remove('active');
                });
            }
            else {
                document.querySelectorAll('.bottom-nav .nav-button').forEach(button => {
                    button.classList.remove('active');
                });
            }
        }

        const originalNavigateTo = navigateTo;
        navigateTo = function(targetScreenId) {
            const currentScreenEl = document.querySelector('.container.active-screen');
            const navBarTargetScreens = ['homePrikazPijanki', 'praznaTrazilica', 'inboxPrikaz', 'glavniDio', 'editProfil'];

            const confirmButton = document.getElementById('sacuvajProfilBtn');
            if (confirmButton) {
                if (targetScreenId === 'editProfil') {
                    confirmButton.classList.remove('hidden');
                } else {
                    confirmButton.classList.add('hidden');
                }
            }

            const isNavigatingWithinNavbar = (currentScreenEl && navBarTargetScreens.includes(currentScreenEl.id) && navBarTargetScreens.includes(targetScreenId));
            const isNavigatingFromEditToProfile = (currentScreenEl && currentScreenEl.id === 'editProfil' && targetScreenId === 'glavniDio');
            const isNavigatingFromChatToChat = (currentScreenEl && currentScreenEl.id === 'privatniChat' && targetScreenId === 'privatniChat');


            if (!isNavigatingWithinNavbar && !isNavigatingFromEditToProfile && !isNavigatingFromChatToChat && currentScreenEl) {
                navigationStack.push(currentScreenEl.id);
            }

            swap(currentScreenEl ? currentScreenEl.id : null, targetScreenId);
            // afterSwapUpdateNavButton se sada poziva unutar swap funkcije's animationend listenera
            // ili odmah ako nema animacije, ≈°to osigurava pravilan redoslijed.
        };

        const originalNavigateBack = navigateBack;
        navigateBack = function() {
            originalNavigateBack();

            setTimeout(() => {
                const newActiveScreenEl = document.querySelector('.container.active-screen');
                if (newActiveScreenEl) {
                    afterSwapUpdateNavButton(newActiveScreenEl.id);
                } else {
                    document.querySelectorAll('.bottom-nav .nav-button').forEach(button => {
                        button.classList.remove('active');
                    });
                }

                const confirmButton = document.getElementById('sacuvajProfilBtn');
                if (confirmButton) {
                    if (newActiveScreenEl && newActiveScreenEl.id !== 'editProfil') {
                        confirmButton.classList.add('hidden');
                    }
                }
            }, 300);
        };

        const originalPokaziObjavu = pokaziObjavu;
        pokaziObjavu = function() {
            originalPokaziObjavu();
            // Nema potrebe sakrivati nav bar ovdje, jer afterSwapUpdateNavButton to rje≈°ava
        };

        function filterChatItems() {
            const searchTerm = document.getElementById('inboxSearchBarInput').value.toLowerCase();
            const chatItems = document.querySelectorAll('#listaChatova .chat-item');
            chatItems.forEach(item => {
                const partnerName = item.dataset.partnerName;
                if (partnerName.includes(searchTerm)) {
                    item.style.display = 'flex';
                } else {
                    item.style.display = 'none';
                }
            });
        }

        // === KLJUƒåNA IZMJENA: Dodan listener unutar swap funkcije ===
        // Premje≈°tamo afterSwapUpdateNavButton poziv ovdje
        const originalSwap = swap;
        swap = function(hideId, showId) {
            const hideElement = document.getElementById(hideId);
            const showElement = document.getElementById(showId);
            if (!showElement) return;

            const showNewElementAndCallAfterSwap = () => {
                showElement.style.display = 'flex';
                setTimeout(() => {
                    showElement.classList.add('active-screen');
                    afterSwapUpdateNavButton(showId); // Pozovi nakon ≈°to je novi ekran aktivan
                }, 10);
            };

            if (hideElement && hideElement.classList.contains('active-screen')) {
                hideElement.classList.remove('active-screen');
                hideElement.classList.add('fade-out-screen');
                hideElement.addEventListener('animationend', function handler() {
                    hideElement.style.display = 'none';
                    hideElement.classList.remove('fade-out-screen');
                    hideElement.removeEventListener('animationend', handler);
                    showNewElementAndCallAfterSwap();
                }, { once: true });
            } else {
                // Ako nema hide animacije, samo prika≈æi novi element i pozovi afterSwap
                if (hideElement) { // Provjeri da hideElement postoji prije sakrivanja
                    hideElement.style.display = 'none';
                    hideElement.classList.remove('active-screen', 'fade-out-screen');
                }
                showNewElementAndCallAfterSwap();
            }
        };
        // ===========================================================
        
        // Funkcija za prikazivanje/skrivanje poruke "nema pijanki"
        // Morate implementirati `prikaziPijankePregled` u va≈°em `script.js`
        // tako da provjerava ima li pijanki. Ako nema, prika≈æe `#noPijankeMessage` i sakrije `#pijankePregled`.
        // Ako ima, sakrije `#noPijankeMessage` i prika≈æe `#pijankePregled` (i napuni ga).

        // Primjer kako bi va≈°a funkcija `prikaziPijankePregled` u `script.js` trebala biti prilagoƒëena:
        /*
        async function prikaziPijankePregled() {
            const pijankeContainer = document.getElementById('pijankePregled');
            const noPijankeMessage = document.getElementById('noPijankeMessage');
            
            // Pretpostavimo da dohvaƒáate pijanke ovdje
            const pijanke = await fetchPijankeFromServer(); // Va≈°a funkcija za dohvat pijanki

            if (pijanke && pijanke.length > 0) {
                // Ima pijanki, prika≈æi ih
                noPijankeMessage.style.display = 'none';
                pijankeContainer.style.display = 'block'; // Ili 'flex', ovisno o layoutu pijanki
                pijankeContainer.innerHTML = ''; // Oƒçistite stari sadr≈æaj
                pijanke.forEach(pijanka => {
                    // Ovdje kreirajte HTML za svaku pijanku i dodajte u pijankeContainer
                    const pijankaDiv = document.createElement('div');
                    pijankaDiv.className = 'pijanka';
                    pijankaDiv.innerHTML = `
                        <div class="pijanka-header" data-user-id="${pijanka.userId}">
                            <img src="${pijanka.profilnaSlika}" alt="Profilna slika" class="pijanka-profilna-slika">
                            <div class="pijanka-info-text">
                                <strong>${pijanka.ime}</strong>
                                <span class="status-text">${pijanka.status}</span>
                            </div>
                            <button class="delete-btn" onclick="obrisiPijanku('${pijanka.id}')">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" style="width: 16px; height: 16px;">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                                </svg>
                            </button>
                        </div>
                        <div class="pijanka-opis">
                            <p>${pijanka.opis}</p>
                        </div>
                    `;
                    pijankeContainer.appendChild(pijankaDiv);
                });
            } else {
                // Nema pijanki, prika≈æi poruku
                pijankeContainer.innerHTML = ''; // Ukloni sve pijanke ako ih je bilo
                pijankeContainer.style.display = 'none';
                noPijankeMessage.style.display = 'flex'; // Prikazi poruku
            }
        }
        */
    </script>
</body>
</html>